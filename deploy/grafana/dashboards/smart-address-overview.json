{
  "uid": "smart-address-overview",
  "title": "Smart Address Overview",
  "tags": ["smart-address", "overview"],
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 1,
  "refresh": "10s",
  "time": {
    "from": "now-15m",
    "to": "now"
  },
  "templating": {
    "list": [
      {
        "name": "job",
        "type": "query",
        "datasource": { "type": "prometheus", "uid": "prometheus" },
        "query": "label_values(smart_address_cache_requests_total, job)",
        "refresh": 1,
        "includeAll": true,
        "allValue": ".*",
        "current": { "text": "smart-address", "value": "smart-address" }
      },
      {
        "name": "provider",
        "type": "query",
        "datasource": { "type": "prometheus", "uid": "prometheus" },
        "query": "label_values(smart_address_provider_calls_total, provider)",
        "refresh": 1,
        "includeAll": true,
        "allValue": ".*",
        "current": { "text": "All", "value": "$__all" }
      }
    ]
  },
  "panels": [
    {
      "id": 1,
      "type": "timeseries",
      "title": "Requests/s (cache requests)",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "rate(smart_address_cache_requests_total{job=~\"$job\"}[5m])",
          "legendFormat": "{{instance}}",
          "refId": "A"
        }
      ],
      "fieldConfig": { "defaults": {}, "overrides": [] },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 0 }
    },
    {
      "id": 2,
      "type": "timeseries",
      "title": "Cache hit rate",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "smart_address_cache_hit_rate{job=~\"$job\"}",
          "legendFormat": "overall",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": { "unit": "percentunit", "min": 0, "max": 1 },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 0 }
    },
    {
      "id": 3,
      "type": "timeseries",
      "title": "Provider latency (avg ms)",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "smart_address_provider_latency_ms{job=~\"$job\",stat=\"avg\",provider=~\"$provider\"}",
          "legendFormat": "{{provider}}",
          "refId": "A"
        }
      ],
      "fieldConfig": { "defaults": { "unit": "ms" }, "overrides": [] },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 0 }
    },
    {
      "id": 4,
      "type": "timeseries",
      "title": "Provider errors/s",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "rate(smart_address_provider_errors_total{job=~\"$job\",provider=~\"$provider\"}[5m])",
          "legendFormat": "{{provider}}",
          "refId": "A"
        }
      ],
      "fieldConfig": { "defaults": {}, "overrides": [] },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 8 }
    },
    {
      "id": 5,
      "type": "timeseries",
      "title": "Cache hit rate (L1/L2)",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "smart_address_cache_l1_hit_rate{job=~\"$job\"}",
          "legendFormat": "L1",
          "refId": "A"
        },
        {
          "expr": "smart_address_cache_l2_hit_rate{job=~\"$job\"}",
          "legendFormat": "L2",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": { "unit": "percentunit", "min": 0, "max": 1 },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 8 }
    },
    {
      "id": 6,
      "type": "timeseries",
      "title": "Provider calls/s",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "rate(smart_address_provider_calls_total{job=~\"$job\",provider=~\"$provider\"}[5m])",
          "legendFormat": "{{provider}}",
          "refId": "A"
        }
      ],
      "fieldConfig": { "defaults": {}, "overrides": [] },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 8 }
    },
    {
      "id": 7,
      "type": "logs",
      "title": "Service logs (all)",
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "expr": "{job=~\"$job\"}",
          "refId": "A"
        }
      ],
      "options": { "showTime": true, "wrapLogMessage": true },
      "gridPos": { "h": 10, "w": 12, "x": 0, "y": 16 }
    },
    {
      "id": 8,
      "type": "logs",
      "title": "Wide events (suggest)",
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "expr": "{job=~\"$job\", kind=\"suggest\"}",
          "refId": "A"
        }
      ],
      "options": { "showTime": true, "wrapLogMessage": true },
      "gridPos": { "h": 10, "w": 12, "x": 12, "y": 16 }
    }
  ]
}
